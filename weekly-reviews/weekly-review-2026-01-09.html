<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OpenPinas: Weekly News Review - Week of January 3-9, 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;500;600;700&family=Source+Serif+Pro:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --ink: #1a1a1a;
        --muted: #5e5e5e;
        --paper: #f8f5f0;
        --accent: #124559;
        --accent-2: #c44900;
        --weather: #0b6e4f;
        --politics: #3a0ca3;
        --culture: #b23a48;
        --economic: #3a0ca3;
        --legal: #1e3a5f;
        --international: #0d7377;
        --religious: #d4a017;
        --card: #ffffff;
        --line: #d6cbbd;
        --shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Source Serif Pro", Georgia, serif;
        color: var(--ink);
        background: radial-gradient(1200px 600px at 80% -10%, #f0e7d7 0%, transparent 60%),
          radial-gradient(800px 500px at 10% 10%, #e6efe7 0%, transparent 55%),
          var(--paper);
        line-height: 1.6;
      }

      header {
        padding: 32px 24px 20px;
        max-width: 1100px;
        margin: 0 auto;
      }

      h1 {
        font-size: clamp(28px, 4vw, 44px);
        margin: 0 0 8px;
        letter-spacing: 0.3px;
      }

      .week-range {
        font-size: 18px;
        color: var(--muted);
        margin: 0 0 20px;
        font-weight: 500;
      }

      .nav-links {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        margin: 20px 0;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.75);
        border: 1px solid #eadfce;
        border-radius: 14px;
        box-shadow: var(--shadow);
      }

      .nav-links a {
        color: var(--accent);
        text-decoration: none;
        font-family: "Source Sans Pro", Arial, sans-serif;
        font-weight: 500;
        padding: 6px 12px;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .nav-links a:hover {
        background: rgba(18, 69, 89, 0.1);
        text-decoration: none;
      }

      main {
        max-width: 1100px;
        margin: 16px auto 60px;
        padding: 0 24px;
      }

      /* Two-column sidebar layout */
      .sidebar-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 24px 0 32px;
      }

      @media (max-width: 800px) {
        .sidebar-row {
          grid-template-columns: 1fr;
        }
      }

      .left-sidebar {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .summary-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        align-content: start;
      }

      /* Weather Widget */
      .weather-widget {
        background: linear-gradient(135deg, #0b6e4f 0%, #1a936f 100%);
        border-radius: 12px;
        padding: 14px;
        color: #fff;
        box-shadow: var(--shadow);
      }

      .weather-widget h3 {
        margin: 0 0 10px;
        font-size: 12px;
        font-weight: 600;
        color: #fff;
        font-family: "Source Sans Pro", sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.9;
      }

      .weather-forecast {
        display: flex;
        gap: 4px;
        justify-content: space-between;
      }

      .weather-day {
        text-align: center;
        flex: 1;
        padding: 6px 2px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
      }

      .weather-day .day-date {
        font-size: 8px;
        opacity: 0.7;
        display: block;
        margin-bottom: 2px;
        font-family: "Source Sans Pro", sans-serif;
      }

      .weather-day .day-name {
        font-size: 9px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.9;
        display: block;
        margin-bottom: 4px;
        font-family: "Source Sans Pro", sans-serif;
      }

      .weather-day .weather-icon {
        font-size: 16px;
        display: block;
        margin: 2px 0;
      }

      .weather-day .temps {
        font-size: 10px;
        display: block;
        font-family: "Source Sans Pro", sans-serif;
      }

      .weather-day .temps .high { font-weight: 600; }
      .weather-day .temps .low { opacity: 0.7; }

      .weather-source {
        margin: 8px 0 0;
        font-size: 9px;
        opacity: 0.6;
        font-family: "Source Sans Pro", sans-serif;
        text-align: right;
      }

      .stat-card {
        background: var(--card);
        padding: 14px 12px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        text-align: center;
      }

      .stat-card .number {
        font-size: 26px;
        font-weight: 700;
        color: var(--accent);
        margin: 0;
        line-height: 1.1;
      }

      .stat-card .label {
        font-size: 11px;
        color: var(--muted);
        margin: 4px 0 0;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .section {
        margin: 40px 0;
      }

      .section-title {
        font-size: 24px;
        margin: 0 0 20px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--line);
        color: var(--ink);
      }

      .event {
        background: var(--card);
        border-radius: 16px;
        padding: 20px 24px;
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--accent);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .event:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
      }

      .event-header {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }

      .event time {
        font-family: "Source Sans Pro", Arial, sans-serif;
        font-size: 14px;
        color: var(--muted);
        font-weight: 500;
      }

      .category-badge {
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        color: #fff;
        font-family: "Source Sans Pro", Arial, sans-serif;
        font-weight: 600;
      }

      .category-badge.political {
        background: var(--politics);
      }

      .category-badge.cultural {
        background: var(--culture);
      }

      .category-badge.natural-disasters {
        background: var(--weather);
      }

      .category-badge.economic {
        background: var(--economic);
      }

      .category-badge.legal {
        background: var(--legal);
      }

      .category-badge.international-relations {
        background: var(--international);
      }

      .category-badge.religious {
        background: var(--religious);
      }

      .category-badge.ofw {
        background: #2563eb;
      }

      /* Exchange Rate Box - Compact for sidebar */
      .exchange-rate-box {
        background: linear-gradient(135deg, #1e3a5f 0%, #124559 100%);
        border-radius: 12px;
        padding: 16px;
        color: #fff;
        box-shadow: var(--shadow);
      }

      .exchange-rate-box h3 {
        margin: 0 0 10px;
        font-size: 13px;
        font-weight: 600;
        color: #fff;
        font-family: "Source Sans Pro", sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.9;
      }

      .rate-display {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .current-rate {
        text-align: center;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.15);
      }

      .rate-value {
        font-size: 32px;
        font-weight: 700;
        display: block;
        line-height: 1.1;
      }

      .rate-trend {
        font-size: 13px;
        padding: 3px 8px;
        border-radius: 4px;
        display: inline-block;
        margin-top: 6px;
        font-family: "Source Sans Pro", sans-serif;
        font-weight: 600;
      }

      .rate-trend.up { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
      .rate-trend.down { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }

      .rate-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .rate-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 6px;
        border-radius: 6px;
        text-align: center;
      }

      .rate-item .label {
        font-size: 9px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        opacity: 0.8;
        display: block;
        margin-bottom: 2px;
        font-family: "Source Sans Pro", sans-serif;
      }

      .rate-item .value { font-size: 14px; font-weight: 600; }
      .rate-context { margin: 8px 0 4px; font-size: 11px; opacity: 0.85; line-height: 1.4; }
      .rate-source { font-size: 10px; opacity: 0.6; margin: 0; font-family: "Source Sans Pro", sans-serif; }

      /* OFW Section */
      .ofw-section {
        background: var(--card);
        border-radius: 16px;
        padding: 24px;
        margin: 32px 0;
        box-shadow: var(--shadow);
        border-left: 4px solid #2563eb;
      }

      .ofw-section h2 { margin: 0 0 20px; color: #2563eb; font-size: 22px; }

      .ofw-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .ofw-stat {
        background: rgba(37, 99, 235, 0.05);
        padding: 16px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid rgba(37, 99, 235, 0.1);
      }

      .ofw-stat .number { font-size: 28px; font-weight: 700; color: #2563eb; display: block; }
      .ofw-stat .label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.3px; }

      .ofw-story {
        padding: 16px;
        margin: 12px 0;
        background: rgba(37, 99, 235, 0.03);
        border-radius: 10px;
        border-left: 3px solid #2563eb;
      }

      .ofw-story h3 { margin: 0 0 8px; font-size: 16px; color: var(--ink); }
      .ofw-story p { margin: 0 0 10px; font-size: 14px; line-height: 1.6; }

      .ofw-details {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        font-size: 12px;
        color: var(--muted);
      }

      .ofw-details a { color: #2563eb; text-decoration: none; }
      .ofw-details a:hover { text-decoration: underline; }

      .travel-advisory {
        margin-top: 20px;
        padding: 16px;
        background: rgba(239, 68, 68, 0.05);
        border-radius: 10px;
        border-left: 3px solid #ef4444;
      }

      .travel-advisory h4 { margin: 0 0 10px; font-size: 14px; color: #ef4444; }
      .travel-advisory ul { margin: 0; padding-left: 20px; font-size: 13px; }
      .travel-advisory li { margin: 4px 0; }

      .event h2 {
        margin: 0 0 12px;
        font-size: 20px;
      }

      .event h2 a {
        color: var(--ink);
        text-decoration: none;
      }

      .event h2 a:hover {
        color: var(--accent-2);
        text-decoration: underline;
      }

      .event .description {
        font-size: 15px;
        color: var(--ink);
        margin: 12px 0;
        line-height: 1.7;
      }

      .event-details {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--line);
      }

      .event-details p {
        margin: 10px 0;
        font-size: 14px;
        line-height: 1.6;
      }

      .event-details strong {
        color: var(--ink);
        font-weight: 600;
      }

      .significance {
        padding: 10px 14px;
        background: rgba(18, 69, 89, 0.05);
        border-left: 3px solid var(--accent);
        border-radius: 6px;
        margin: 12px 0;
      }

      .diaspora-impact {
        padding: 10px 14px;
        background: rgba(196, 73, 0, 0.05);
        border-left: 3px solid var(--accent-2);
        border-radius: 6px;
        margin: 12px 0;
      }

      .dynasties {
        margin: 12px 0;
        padding: 12px;
        background: rgba(58, 12, 163, 0.05);
        border-left: 3px solid var(--politics);
        border-radius: 6px;
        font-size: 14px;
      }

      .dynasties a {
        color: var(--politics);
        text-decoration: none;
        font-weight: 500;
        margin: 0 4px;
      }

      .dynasties a:hover {
        text-decoration: underline;
      }

      .sources {
        margin: 12px 0;
        font-size: 14px;
      }

      .sources a {
        color: var(--accent-2);
        text-decoration: none;
        margin: 0 8px 0 0;
      }

      .sources a:hover {
        text-decoration: underline;
      }

      .dynasty-highlights {
        background: var(--card);
        border-radius: 16px;
        padding: 24px;
        margin: 32px 0;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--politics);
      }

      .dynasty-highlights h3 {
        margin: 0 0 16px;
        color: var(--politics);
      }

      .dynasty-item {
        padding: 12px;
        margin: 8px 0;
        background: rgba(58, 12, 163, 0.05);
        border-radius: 8px;
        border-left: 3px solid var(--politics);
      }

      .dynasty-item a {
        color: var(--politics);
        text-decoration: none;
        font-weight: 600;
      }

      .dynasty-item a:hover {
        text-decoration: underline;
      }

      footer {
        max-width: 1100px;
        margin: 60px auto 40px;
        padding: 24px;
        text-align: center;
        color: var(--muted);
        font-size: 14px;
        border-top: 1px solid var(--line);
      }

      footer a {
        color: var(--accent);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      .empty-state {
        padding: 40px;
        text-align: center;
        color: var(--muted);
        background: var(--card);
        border-radius: 16px;
        box-shadow: var(--shadow);
      }

      @media (max-width: 720px) {
        header {
          padding: 24px 18px 16px;
        }

        main {
          padding: 0 18px;
        }

        .event {
          padding: 16px 18px;
        }

        .summary-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav style="font-size: 0.875rem; margin-bottom: 16px; font-family: 'Source Sans Pro', sans-serif;">
        <a href="../" style="color: var(--muted); text-decoration: none;">‚Üê OpenPinas</a>
      </nav>
      <h1>OpenPinas: Weekly News Review</h1>
      <p class="week-range">Week of January 3-9, 2026</p>
      <nav class="nav-links">
        <a href="../interactive-timeline/">üìÖ Full Timeline</a>
        <a href="../dynasties-network-visualization.html">üó∫Ô∏è Dynasty Map</a>
        <a href="index.html">üìö All Reviews</a>
      </nav>
    </header>

    <main>
      <!-- Two-column layout: Stats + Weather | Exchange Rate side by side -->
      <div class="sidebar-row">
        <div class="left-sidebar">
          <section class="summary-stats">
            <div class="stat-card">
              <p class="number" id="total-events">0</p>
              <p class="label">Total Events</p>
            </div>
            <div class="stat-card">
              <p class="number" id="political-count">0</p>
              <p class="label">Political</p>
            </div>
            <div class="stat-card">
              <p class="number" id="disaster-count">0</p>
              <p class="label">Disasters</p>
            </div>
            <div class="stat-card">
              <p class="number" id="dynasty-count">0</p>
              <p class="label">Dynasties</p>
            </div>
          </section>

          <!-- Metro Manila Weather -->
          <section class="weather-widget">
            <h3>Metro Manila Weather</h3>
            <div class="weather-forecast">
              <div class="weather-day">
                <span class="day-date">Jan 3</span>
                <span class="day-name">Fri</span>
                <span class="weather-icon">‚õÖ</span>
                <span class="temps"><span class="high">30¬∞</span> <span class="low">24¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 4</span>
                <span class="day-name">Sat</span>
                <span class="weather-icon">‚òÄÔ∏è</span>
                <span class="temps"><span class="high">31¬∞</span> <span class="low">25¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 5</span>
                <span class="day-name">Sun</span>
                <span class="weather-icon">‚òÄÔ∏è</span>
                <span class="temps"><span class="high">31¬∞</span> <span class="low">25¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 6</span>
                <span class="day-name">Mon</span>
                <span class="weather-icon">‚õÖ</span>
                <span class="temps"><span class="high">30¬∞</span> <span class="low">24¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 7</span>
                <span class="day-name">Tue</span>
                <span class="weather-icon">‚òÅÔ∏è</span>
                <span class="temps"><span class="high">29¬∞</span> <span class="low">24¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 8</span>
                <span class="day-name">Wed</span>
                <span class="weather-icon">‚õÖ</span>
                <span class="temps"><span class="high">30¬∞</span> <span class="low">24¬∞</span></span>
              </div>
              <div class="weather-day">
                <span class="day-date">Jan 9</span>
                <span class="day-name">Thu</span>
                <span class="weather-icon">‚òÄÔ∏è</span>
                <span class="temps"><span class="high">31¬∞</span> <span class="low">25¬∞</span></span>
              </div>
            </div>
            <p class="weather-source">Source: PAGASA</p>
          </section>
        </div>

        <!-- PHP:USD Exchange Rate Box -->
        <section class="exchange-rate-box">
          <h3>PHP:USD Exchange Rate</h3>
          <div class="rate-display">
            <div class="current-rate">
              <span class="rate-value">‚Ç±58.95</span>
              <span class="rate-trend up">‚ñ≤ 0.20% this week</span>
            </div>
            <div class="rate-details">
              <div class="rate-item">
                <span class="label">Open</span>
                <span class="value">‚Ç±58.83</span>
              </div>
              <div class="rate-item">
                <span class="label">High</span>
                <span class="value">‚Ç±59.05</span>
              </div>
              <div class="rate-item">
                <span class="label">Low</span>
                <span class="value">‚Ç±58.80</span>
              </div>
              <div class="rate-item">
                <span class="label">Close</span>
                <span class="value">‚Ç±58.95</span>
              </div>
            </div>
            <p class="rate-context">
              <strong>2026:</strong> ‚Ç±58.75‚Äì‚Ç±59.05 | Up 0.20% from week start
            </p>
            <p class="rate-source">Source: BSP / Bloomberg</p>
          </div>
        </section>
      </div>

      <!-- Events will be inserted here by JavaScript -->
      <section id="events-container">
        <div class="empty-state">
          <p>Loading events for this week...</p>
        </div>
      </section>

      <!-- OFW & Diaspora News Section -->
      <section class="ofw-section">
        <h2>OFW & Diaspora News</h2>

        <div class="ofw-stats">
          <div class="ofw-stat">
            <span class="number">2.57M</span>
            <span class="label">OFWs deployed in 2025</span>
          </div>
          <div class="ofw-stat">
            <span class="number">$38.4B</span>
            <span class="label">Remittances (2024)</span>
          </div>
          <div class="ofw-stat">
            <span class="number">72</span>
            <span class="label">Labor Agreements</span>
          </div>
          <div class="ofw-stat">
            <span class="number">‚Ç±2.18B</span>
            <span class="label">Aksyon Fund Aid (2025)</span>
          </div>
        </div>

        <article class="ofw-story">
          <h3>Oman MOU on Labor Cooperation Expected in January 2026</h3>
          <p>The Department of Migrant Workers expects to sign the Oman Memorandum of Understanding on Labor Cooperation in January 2026, opening new deployment opportunities for household workers, technicians, and port staff. This follows 10 new bilateral labor agreements signed in 2025, bringing the total to 72 agreements.</p>
          <div class="ofw-details">
            <span>New market: Oman</span>
            <a href="https://www.pna.gov.ph/articles/1266047" target="_blank">PNA</a>
          </div>
        </article>

        <div class="travel-advisory">
          <h4>Active Travel Advisories</h4>
          <ul>
            <li><strong>Deployment Suspended:</strong> Israel, Lebanon, Iran, Jordan ‚Äì due to ongoing conflict</li>
            <li><strong>Exercise Caution:</strong> Myanmar, parts of Southeast Asia ‚Äì scam hub operations</li>
            <li><strong>New Market Opening:</strong> Oman MOU expected January 2026</li>
          </ul>
        </div>
      </section>

      <section class="dynasty-highlights" id="dynasty-highlights">
        <h3>Dynasty Highlights</h3>
        <div id="dynasty-content">
          <p>Loading dynasty highlights...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>
        Part of the
        <a href="https://github.com/dat-angel/openpinas"
          >Philippine Political Dynasties</a
        >
        project
      </p>
      <p>
        <a href="https://github.com/dat-angel/openpinas">GitHub</a> |
        <a href="../interactive-timeline/">Timeline</a> |
        <a href="../dynasties-network-visualization.html">Dynasty Map</a>
      </p>
      <p style="margin-top: 12px; font-size: 12px;">
        Last updated: <span id="last-updated">January 9, 2026</span>
      </p>
      <p style="margin-top: 8px; font-size: 12px;">
        <strong>New Data:</strong> <a href="../business-connections-2025.json" style="color: var(--accent);">Business Connections Dataset</a> now available - tracking PBA teams, conglomerates, media ownership, and political connections.
      </p>
      <p style="margin-top: 8px; font-size: 12px;">
        <strong>Recent Updates:</strong> Added airport passenger data, exchange rate tracking, and "when to go" travel guide. See <a href="https://github.com/dat-angel/openpinas" style="color: var(--accent);">GitHub</a> for latest changes.
      </p>
    </footer>

    <script>
      // Configuration - Update these for each week
      const WEEK_CONFIG = {
        startDate: "2026-01-03",
        endDate: "2026-01-09",
        timelineFile: "../philippines-2026-timeline.json",
        weekLabel: "January 3-9, 2026"
      };

      // Category mapping
      const categoryMap = {
        "Political": { slug: "political", display: "Political" },
        "Cultural": { slug: "cultural", display: "Cultural" },
        "Natural Disasters": { slug: "natural-disasters", display: "Natural Disasters" },
        "Economic": { slug: "economic", display: "Economic" },
        "Legal": { slug: "legal", display: "Legal" },
        "International Relations": { slug: "international-relations", display: "International Relations" },
        "Religious": { slug: "religious", display: "Religious" }
      };

      // Format date for display
      function formatDate(dateString) {
        const date = new Date(dateString + "T00:00:00");
        return date.toLocaleDateString("en-US", { 
          month: "long", 
          day: "numeric", 
          year: "numeric" 
        });
      }

      // Format date for URL
      function formatDateForURL(dateString) {
        return dateString;
      }

      // Get dynasty display name from ID
      function getDynastyName(id) {
        const names = {
          "MARCOS_ROMUALDEZ": "Marcos-Romualdez",
          "DUTERTE_FAMILY": "Duterte",
          "AQUINO_FAMILY": "Aquino",
          "REVILLA_TOLENTINO": "Revilla-Tolentino",
          "ESTRADA_FAMILY": "Estrada",
          "VILLAR_FAMILY": "Villar",
          "PACQUIAO_FAMILY": "Pacquiao",
          "SINGSON_FAMILY": "Singson",
          "ORTEGA_FAMILY": "Ortega",
          "TULFO_FAMILY": "Tulfo",
          "LACSON_FAMILY": "Lacson",
          "GO_FAMILY": "Go",
          "DELA_ROSA_FAMILY": "Dela Rosa",
          "BINAY_FAMILY": "Binay"
        };
        return names[id] || id.replace(/_/g, " ");
      }

      // Create event HTML
      function createEventHTML(event) {
        const category = categoryMap[event.category] || { slug: "political", display: event.category };
        const eventId = `event-${event.date}-${event.title.toLowerCase().replace(/\s+/g, "-").slice(0, 30)}`;
        
        let dynastiesHTML = "";
        if (event.mentioned_dynasties && event.mentioned_dynasties.length > 0) {
          const dynastyLinks = event.mentioned_dynasties.map(id => {
            const name = getDynastyName(id);
            return `<a href="../dynasties-network-visualization.html#dynasty-${id}">${name}</a>`;
          }).join(", ");
          dynastiesHTML = `<div class="dynasties"><strong>Dynasties:</strong> ${dynastyLinks}</div>`;
        }

        let sourcesHTML = "";
        const allSources = [
          ...(event.sources?.international || []),
          ...(event.sources?.local || [])
        ];
        if (allSources.length > 0) {
          const sourceLinks = allSources.map((url, idx) => {
            const domain = new URL(url).hostname.replace("www.", "");
            return `<a href="${url}" target="_blank" rel="noopener">${domain}</a>`;
          }).join(", ");
          sourcesHTML = `<div class="sources"><strong>Sources:</strong> ${sourceLinks}</div>`;
        }

        return `
          <article class="event" data-category="${category.slug}" data-date="${event.date}">
            <div class="event-header">
              <time datetime="${event.date}">${formatDate(event.date)}</time>
              <span class="category-badge ${category.slug}">${category.display}</span>
            </div>
            <h2>
              <a href="../interactive-timeline/?date=${formatDateForURL(event.date)}&search=${encodeURIComponent(event.title)}">
                ${event.title}
              </a>
            </h2>
            <p class="description">${event.description}</p>
            <div class="event-details">
              ${event.significance ? `<p class="significance"><strong>Significance:</strong> ${event.significance}</p>` : ""}
              ${event.diaspora_impact ? `<p class="diaspora-impact"><strong>Diaspora Impact:</strong> ${event.diaspora_impact}</p>` : ""}
              ${dynastiesHTML}
              ${sourcesHTML}
            </div>
          </article>
        `;
      }

      // Group events by category
      function groupEventsByCategory(events) {
        const grouped = {};
        events.forEach(event => {
          const category = event.category || "Political";
          if (!grouped[category]) {
            grouped[category] = [];
          }
          grouped[category].push(event);
        });
        return grouped;
      }

      // Render events
      function renderEvents(events) {
        const container = document.getElementById("events-container");
        
        if (events.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <p>No significant events recorded for this week.</p>
            </div>
          `;
          return;
        }

        const grouped = groupEventsByCategory(events);
        const categoryOrder = ["Political", "Natural Disasters", "Economic", "Legal", "International Relations", "Cultural", "Religious"];
        
        let html = "";
        categoryOrder.forEach(category => {
          if (grouped[category] && grouped[category].length > 0) {
            html += `<section class="section">
              <h2 class="section-title">${category}</h2>
              ${grouped[category].map(event => createEventHTML(event)).join("")}
            </section>`;
          }
        });

        container.innerHTML = html;
      }

      // Update statistics
      function updateStats(events) {
        const political = events.filter(e => e.category === "Political" || e.category === "Economic" || e.category === "Legal" || e.category === "International Relations").length;
        const disasters = events.filter(e => e.category === "Natural Disasters").length;
        const dynasties = new Set();
        events.forEach(event => {
          if (event.mentioned_dynasties) {
            event.mentioned_dynasties.forEach(id => dynasties.add(id));
          }
        });

        document.getElementById("total-events").textContent = events.length;
        document.getElementById("political-count").textContent = political;
        document.getElementById("disaster-count").textContent = disasters;
        document.getElementById("dynasty-count").textContent = dynasties.size;
      }

      // Render dynasty highlights
      function renderDynastyHighlights(events) {
        const container = document.getElementById("dynasty-content");
        const dynastyEvents = events.filter(e => e.mentioned_dynasties && e.mentioned_dynasties.length > 0);
        
        if (dynastyEvents.length === 0) {
          container.innerHTML = "<p>No significant dynasty news this week.</p>";
          return;
        }

        const dynastyMap = {};
        dynastyEvents.forEach(event => {
          event.mentioned_dynasties.forEach(id => {
            if (!dynastyMap[id]) {
              dynastyMap[id] = [];
            }
            dynastyMap[id].push(event);
          });
        });

        let html = "";
        Object.keys(dynastyMap).sort().forEach(id => {
          const name = getDynastyName(id);
          const relatedEvents = dynastyMap[id];
          html += `
            <div class="dynasty-item">
              <strong>
                <a href="../dynasties-network-visualization.html#dynasty-${id}">${name}</a>
              </strong>
              <ul style="margin: 8px 0 0 20px; padding: 0;">
                ${relatedEvents.map(e => `<li><a href="../interactive-timeline/?date=${formatDateForURL(e.date)}">${e.title}</a></li>`).join("")}
              </ul>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // Load and process timeline data
      async function loadWeekReview() {
        try {
          // Update page title and header
          document.title = `OpenPinas: Weekly News Review - Week of ${WEEK_CONFIG.weekLabel}`;
          document.querySelector(".week-range").textContent = `Week of ${WEEK_CONFIG.weekLabel}`;
          document.getElementById("last-updated").textContent = new Date().toLocaleDateString("en-US", { 
            year: "numeric", 
            month: "long", 
            day: "numeric" 
          });

          // Load timeline JSON
          const response = await fetch(WEEK_CONFIG.timelineFile);
          if (!response.ok) {
            throw new Error(`Failed to load timeline: ${response.statusText}`);
          }
          
          const data = await response.json();
          const timeline = data.timeline || [];

          // Filter events for this week
          const weekEvents = timeline.filter(event => {
            const eventDate = event.date;
            return eventDate >= WEEK_CONFIG.startDate && eventDate <= WEEK_CONFIG.endDate;
          });

          // Sort by date
          weekEvents.sort((a, b) => a.date.localeCompare(b.date));

          // Render everything
          renderEvents(weekEvents);
          updateStats(weekEvents);
          renderDynastyHighlights(weekEvents);

        } catch (error) {
          console.error("Error loading week review:", error);
          document.getElementById("events-container").innerHTML = `
            <div class="empty-state">
              <p>Error loading events: ${error.message}</p>
              <p style="margin-top: 12px; font-size: 14px;">
                Make sure the timeline JSON file exists at: ${WEEK_CONFIG.timelineFile}
              </p>
            </div>
          `;
        }
      }

      // Initialize on page load
      loadWeekReview();
    </script>
  </body>
</html>
